<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">Lista de clientes</h4>

                <div class="d-flex justify-content-between flex-wrap mt-1">

                    <div class="my-2">

                        <div>
                            <label for="mostrar" class="me-2">Mostrar: </label>
                            <select name="" id="" [value]="query.hasta" #mostrar (change)="limiteChange(mostrar.value)">
                                <option value="10">10</option>
                                <option value="25">25</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                                <option value="250">250</option>
                                <option value="500">500</option>
                                <option value="1000">1000</option>
                                <option value="2500">2500</option>
                                <option value="5000">5000</option>
                            </select>

                        </div>

                        <div>
                            <label for="ordenar" class="me-2">Ordenar: </label>
                            <select name="" id="" #ordenar (change)="ordenChange(ordenar.value)">
                                <option value="ultimos">Ultimos Creados</option>
                                <option value="primeros">Primeros Creados</option>
                                <option value="nombre">Nombre</option>
                            </select>

                        </div>
                        
                        <div>
                            <label for="rutasI" class="me-2">Rutas: </label>
                            <select name="" id="" #rutasI (change)="changeRuta(rutasI.value)">
                                <option value="none">Todas</option>
                                <option *ngFor="let ruta of rutas" [value]="ruta.ruid"> {{ ruta.name }} </option>
                            </select>

                        </div>

                        <div class="">
                            <input type="search" #searchI (keydown)="search(searchI.value)" (keydown.enter)="search(searchI.value)" id="demo-input-search2" placeholder="Busca clientes" class="form-control"> 
                        </div>

                    </div>                    

                    <div class="gap-2">
                        <button *ngIf="user.whatsapp && user.wp" type="button" class="btn btn-success " data-toggle="modal" data-target="#whatsappmasive">
                            Enviar mensajes masivos
                        </button>
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#createClient">
                            Crear Cliente
                        </button>
                        <button type="button" class="btn btn-dark" data-toggle="modal" data-target="#clientesMasivosModal">
                            Subir Excel de clientes
                        </button>

                    </div>

                </div>

                <div class="d-flex justify-content-between mt-3">
                    <button  type="button" (click)="exportar()" class="btn btn-sm btn-success">
                        Exportar Excel
                    </button>
                    
                    <small><span class="fw-bold">Total:</span> {{ total }} </small>
                </div>
                <div class="table-responsive">
                    <table id="demo-foo-addrow" class="table m-t-30 table-hover no-wrap contact-list" data-page-size="10">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>Telefono</th>
                                <th>Cedula</th>
                                <th>Correo</th>
                                <th>Dirección</th>
                                <th>Ruta</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>

                            <tr *ngIf="clients.length === 0">
                                <td colspan="6"> No existen registros de clientes... </td>
                            </tr>

                            <tr *ngFor="let cliente of clients">
                                <td>
                                    {{ cliente.nombre }}
                                </td>
                                <td>
                                    {{ cliente.codigo + cliente.telefono}}
                                </td>
                                <td>{{ cliente.cedula }}</td>
                                <td>{{ cliente.correo }}</td>
                                <td>{{ cliente.direccion || 'Sin Correo' }}</td>
                                <td>{{ cliente.ruta.name }}</td>
                                <td>
                                    <button type="button" (click)="setForm(cliente)" class="btn btn-sm btn-icon btn-pure btn-outline delete-row-btn" data-toggle="modal" data-target="#updateClient">
                                        <i class="ti ti-pencil" aria-hidden="true"></i>
                                    </button>
                                    <button type="button" (click)="setForm(cliente)"  class="btn btn-sm btn-icon btn-pure btn-outline delete-row-btn text-warning" data-toggle="modal" data-target="#alertsClient">
                                        <i class="ti ti-alert" aria-hidden="true"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr>

                                <td colspan="8">

                                    <div class="btn-group" role="group" aria-label="First group">
                                        <button [disabled]="query.desde === 0" (click)="cambiarPagina(query.hasta * -1)" type="button" class="btn btn-dark text-white">Atras</button>
                                        <button [disabled]="( query.desde + query.hasta ) >= total" (click)="cambiarPagina(query.hasta)" type="button" class="btn btn-dark text-white">Siguiente</button>
                                    </div>

                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ========================================================= 
MODAL CREATE
======================================================== -->
<div id="createClient" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="createClient" aria-hidden="true" #modalNewUser>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="createClient">Nuevo Cliente</h4>
            </div>
            <div class="modal-body">

                <app-newclient (actualizar)="addClient($event)"></app-newclient>         

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<!-- ========================================================= 
MODAL UPDATE
======================================================== -->
<div id="updateClient" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="updateClient" aria-hidden="true" #modalNewUser>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="updateClient">Actualizar Cliente</h4>
            </div>
            <div class="modal-body">

                <form class="form-horizontal form-material" autocomplete="off" [formGroup]="updateForm" (ngSubmit)="update()">
                    <div class="form-group has-danger">
                        <div class="col-md-12">
                            <input formControlName="nombre" type="text" class="form-control" placeholder="Nombres">
                            <div *ngIf="validate('nombre')" class="form-control-feedback">
                                <small> El nombre es obligatorio </small>
                            </div>
                        </div>
                    </div>
                    <div class="form-group has-danger">
                        <div class="col-md-12">
                            <label class="control-label">Codigo</label>
                            <select #cs formControlName="codigo" class="form-control custom-select" [ngClass]="{'is-invalid': cs.value === '' && formSubmit, 'is-valid': cs.value !== '' && formSubmit }">
                                <option value="">Seleccionar Codigo</option>
                                <option *ngFor="let pais of paises" [value]="pais.phoneCode">
                                    {{ pais.nameES }} (+{{ pais.phoneCode }})
                                </option>
                            </select>
                            <small id="codigo" *ngIf="cs.value === '' && formSubmit" class="text-danger">Este campo es obligatorio</small>
                        </div>
                    </div>
                    <div class="form-group has-danger">
                        <div class="col-md-12">
                            <input formControlName="telefono" type="text" class="form-control" placeholder="telefono">
                            <small>Ejemplo sin guiones ni espacios 424000000</small>
                            <div *ngIf="validate('telefono')" class="form-control-feedback">
                                <small> El telefono es obligatorio </small>
                            </div>
                        </div>
                    </div>
                    <div class="form-group has-danger">
                        <div class="col-md-12">
                            <input formControlName="cedula" type="text" class="form-control" placeholder="cedula">
                            <div *ngIf="validate('cedula')" class="form-control-feedback">
                                <small> El cedula es obligatorio </small>
                            </div>
                        </div>
                    </div>
                    <div class="form-group has-danger">
                        <div class="col-md-12">
                            <input formControlName="direccion" type="text" class="form-control" placeholder="direccion">
                            <div *ngIf="validate('direccion')" class="form-control-feedback">
                                <small> El direccion es obligatorio </small>
                            </div>
                        </div>
                    </div>
                    <div class="form-group has-danger">
                        <div class="col-md-12">
                            <input formControlName="correo" type="text" class="form-control" placeholder="correo">
                            <div *ngIf="validate('correo')" class="form-control-feedback">
                                <small> El correo es obligatorio </small>
                            </div>
                        </div>
                    </div>
                    <div class="form-group has-danger">
                        <div class="col-md-12">
                            <label class="control-label">Ruta</label>
                            <select formControlName="ruta" class="form-control custom-select">
                                <option value="">Seleccionar ruta</option>
                                <option *ngFor="let ruta of rutas" [value]="ruta.ruid">
                                    {{ ruta.name }}
                                </option>
                            </select>
                            <small class="text-muted">La ruta es obligatoria <a *ngIf="rutas.length === 0" routerLink="/dashboard/rutas" data-dismiss="modal">ir a rutas</a></small>
                        </div>
                    </div>
                    <button [disabled]="formSubmit" type="submit" class="btn btn-info waves-effect btn-block">
                        <span *ngIf="!formSubmit">Actualizar</span>
                        <span *ngIf="formSubmit">Actualizando...</span>
                    </button>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<!-- ========================================================= 
MODAL UPDATE
======================================================== -->
<div *ngIf="clienteSelect" id="alertsClient" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="alertsClient" aria-hidden="true" #modalNewUser>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="alertsClient">Advertencias del Cliente</h4>
            </div>
            <div class="modal-body">

                <div class="d-flex flex-column justify-content-center" *ngIf="clienteSelect.alerts">
                    <div class="alert alert-warning mb-3" role="alert">
                            <span [innerHTML]="clienteSelect.alerts"></span>
                    </div>

                    <button type="button" class="btn btn-danger" (click)="deleteAlerts()">
                        <i class="ti ti-trash"></i> Eliminar advertencia
                    </button>
                </div>

                <div class="d-flex flex-column justify-content-center" *ngIf="!clienteSelect.alerts">
                    <div class="alert alert-info mb-3" role="alert">
                        <span>Este cliente no posee advertencia</span>
                    </div>
                </div>
                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<!-- ========================================================= 
MODAL WHATSAPP MASIVE
======================================================== -->
<div id="whatsappmasive" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="whatsappmasive">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">×</button>
                    <h4 class="modal-title" id="whatsappmasive">Enviar Mensaje Masivo</h4>
                </div>
                <div class="modal-body">

                    <!-- SI ESTA USANDO WATI -->
                    <ng-container *ngIf="user.wati">

                        <div class="form-group">
                            <label>Plantillas de WATI</label>
                            <select class="custom-select col-12" id="templatesWati" (change)="seleccionarPlantilla(st.value)" #st>
                                <option value="none">seleccionar</option>
                                <option *ngFor="let template of templates" [value]="template.id"> {{ template.elementName }} </option>
                            </select>
                        </div>

                        <div *ngIf="templateSelected" class="form-group">
                            <label>Ejemplo</label>
                            <textarea class="form-control" rows="5" [value]="templateSelected!.bodyOriginal || 'empty'" disabled></textarea>
                        </div>

                        <button [disabled]="sendMasive && st.value != 'none'" (click)="sendMassiveWATI()" type="button" class="btn btn-success btn-rounded ms-auto"><i class="mdi mdi-whatsapp"></i> 
                            <span *ngIf="sendMasive">Enviando...</span>
                            <span *ngIf="!sendMasive">Enviar</span>
                        </button>

                    </ng-container>

                    <!-- WP -->
                    <ng-container *ngIf="!user.wati">

                        <div class="d-flex flex-wrapp gap-2">
                            <button (click)="addDeco('@name')" type="button" class="btn btn-primary btn-sm">
                                {{'@name'}}
                            </button>
                        </div>
    
                        <div *ngIf="addImgMasive.checked" class="my-3">
    
                                <div class="form-group file-area border">
                                    <input #fileImgMasive (change)="cambiarImageMasive($event)" type="file" name="images" id="imagesMasive" required="required" multiple="multiple" />
                                    <div class="file-dummy">
    
                                        <div class="default py-5">
                                            <h5 class="text-center card-title text-muted">
                                                Agregar Imagen
                                            </h5>
                                            <p class="text-center card-text fs-2 mb-0">
                                                <i class="mdi mdi-plus"></i>
                                            </p>
                                            <p class="text-center card-text fs-sm">Arrastre la imagen ó dar click aquí</p>
                                        </div>
    
                                        <!-- IMG VALIDA -->
                                        <div class="success">
    
                                            <div class="d-flex justify-content-center" *ngIf="imgTempPMasive">
                                                <div class="mx-auto" style="background-image: url({{imgTempPMasive}});width: 400px; height: 300px; background-repeat: no-repeat; background-size: contain; background-position: center center;"></div>
                                            </div>
    
                                        </div>
                                        <!-- IMG VALIDA -->
                                    </div>
                                </div>
    
                                <div *ngIf="imgTempPMasive" class="d-flex justify-content-between flex-wrap pt-4 gap-2">
                                    <button type="button" class="btn btn-danger btn-sm" (click)="imgTempPMasive = ''; fileImgMasive.value = ''"> Eliminar </button>
                                </div>
                        </div>
    
                        <div class="mt-3">
    
                            <div class="form-group mb-1">
                                <div class="checkbox checkbox-success">
                                    <input id="addImgMasive" #addImgMasive type="checkbox" (change)="addImgMasive.checked = addImgMasive.checked">
                                    <label for="addImgMasive"> Agregar Imagen </label>
                                </div>
                            </div>
    
                            <div class="form-group mb-1">
                                <label>Mensaje</label>
                                <textarea [(ngModel)]="message" #whatMasive class="form-control" rows="5"></textarea>
                                <small class="text-mute"> <span class="fw-bold">Nota: </span>Debes de agregar un mensaje con mas de 5 caracteres</small>
                            </div>
    
                            <button [disabled]="sendMasive || message.length < 5" (click)="sendMasiveW(addImgMasive.checked)" type="button" class="btn btn-success btn-rounded ms-auto"><i class="mdi mdi-whatsapp"></i> 
                                <span *ngIf="sendMasive">Enviando...</span>
                                <span *ngIf="!sendMasive">Enviar</span>
                            </button>
                        </div>
                    </ng-container>
                    


                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Cerrar</button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
</div>

<!-- ========================================================= 
MODAL SUBIR TICKETS MASIVOS
======================================================== -->
<div id="clientesMasivosModal" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="clientesMasivosModal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">×</button>
                <h4 class="modal-title" id="clientesMasivosModal">Subir clientes Masivos</h4>
            </div>
            <div class="modal-body">
                <h3 class="fw-bold mt-4">Subir clientes masivos desde un excel</h3>
                <p class="mb-2">Puedes descargar la plantilla de ejemplo dando <a (click)="plantilla()" class="pointer text-decoration-none text-primary"><i class="ti ti-layout-grid4-alt"></i> click aquí  </a> </p>
                <p class="text-dark"> <b class="fw-bold"> <i class="ti ti-alert"></i> Nota:</b> es importante agregar el codigo del pais sin caracteres ni espacios 58 para venezuela, y el numero de telefono debe ir separado, los correos son en minusculas, y si no desea
                    agregar el numero de cedula puedes agregar el numero telefonico en la cedula tambien.
                </p>
                <hr>
                <div class="form-row align-items-center">
                    <div class="col-10">
                        <input type="file" class="form-control form-control-sm" (change)="selectFileExcel($event)" placeholder="Importar" accept=".xlsx">
                    </div>
                    <div class="col-auto">
                        <button [disabled]="sendExcel" type="button" class="btn btn-primary " (click)="UploadExcel()">
                            <span *ngIf="!sendExcel" >Subir excel</span>
                            <span *ngIf="sendExcel" >Cargando...</span>
                        </button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default waves-effect" data-dismiss="modal">Cerrar</button>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>